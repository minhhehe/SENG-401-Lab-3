<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head>
        <meta charset="utf-8">
        <title>SENG 401 - Lab 3 Task 2</title>
        <link rel="stylesheet" href="style.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script>
            $(function() {
                $.get("handlerequest.php", function(data, status) {
                    $("#container").append("<p>" + data + "</p>");
                });

                $("#submit").click(function() {
                    $.get("handlerequest.php", {
                        requestType: $("#requestType").val(),
                        leftLong: $("#leftLong").val(),
                        bottomLat: $("#bottomLat").val(),
                        rightLong: $("#rightLong").val(),
                        topLat: $("#topLat").val()
                    }, function(data, status) {
                        $("#output").html(data);
                    });
                });

                $(".coordinateInput").keyup(function() { validateInputs(); });

                // FIXME delete unused
                // $("#leftLong").keyup(function(event) {
                //
                //
                //     enableSubmit();
                // });
                //
                // $("#bottomLat").keyup(function(event) {
                //
                //     enableSubmit();
                // });
                //
                // $("#rightLong").keyup(function(event) {
                //
                //
                //     enableSubmit();
                // });
                //
                // $("#topLat").keyup(function(event) {
                //
                // });
            });

            function validateInputs() {
                // Test for non-empty
                if ($(".coordinateInput").val().length == 0) {
                    disableSubmit();
                    return;
                }

                // Test for numeric entry
                if (!hasNumericVal($("#leftLong"))) {
                    disableSubmit("Western longitude must be a number");
                    return;
                }

                if (!hasNumericVal($("#bottomLat"))) {
                    disableSubmit("Southern latitude must be a number");
                    return;
                }

                if (!hasNumericVal($("#rightLong"))) {
                    disableSubmit("Eastern longitude must be a number");
                    return;
                }

                if (!hasNumericVal($("#topLat"))) {
                    disableSubmit("Northern latitude must be a number");
                    return;
                }

                // Test for acceptable lower numeric range
                if (!withinLowerBounds(parseFloat($("#leftLong").val()), -180, $("#rightLong"))) {
                    disableSubmit("Western longitude must be between -180 (inclusive) and eastern longitude (exclusive)");
                    return;
                }

                if (!withinLowerBounds(parseFloat($("#bottomLat").val()), -90, $("#topLat"))) {
                    disableSubmit("Southern latitude must be between -90 (inclusive) and northern latitude (exclusive)");
                    return;
                }

                // Test for acceptable upper numeric range
                if (!withinUpperBounds(parseFloat($("#rightLong").val()), 180, $("#leftLong"))) {
                    disableSubmit("Eastern longitude must be between western longitude (exclusive) and 180 (inclusive)");
                    return;
                }

                if (!withinUpperBounds(parseFloat($("#topLat").val()), 90, $("#bottomLat"))) {
                    disableSubmit("Northern latitude must be between southern latitude (exclusive) and 90 (inclusive)");
                    return;
                }

                enableSubmit();
            }

            function hasNumericVal(textInput) {
                return $.isNumeric(textInput.val());
            }

            function withinLowerBounds(val, min, maxSrc) {
                if (!hasNumericVal(maxSrc)) {
                    return false;
                }


                return val >= min && val < parseFloat(maxSrc.val());
            }

            function withinUpperBounds(val, max, minSrc) {
                if (!hasNumericVal(minSrc)) {
                    return false;
                }

                return val <= max && val > parseFloat(minSrc.val());
            }

            function enableSubmit() {
                $("#submit").prop("disabled", false);
                $("#error").text("");
            }

            function disableSubmit(errorMessage = null) {
                $("#submit").prop("disabled", true);

                if (errorMessage !== null) {
                    $("#error").text(errorMessage);
                }
            }
        </script>
    </head>
    <body>
        <div class="banner">
            <h1>SENG 401 - Lab 3</h1>
            <p>A :() { :|:& };: production</p>
        </div>
        <div class="container">
            <div class="inputBlock">
                <span id="error" class="error"></span>
                <br>

                <label>Southwest Coordinate</label>
                <br>
                <input type="text" id="leftLong" class="coordinateInput" placeholder="West-most longitude">
                <br>
                <input type="text" id="bottomLat" class="coordinateInput" placeholder="South-most latitude">

                <br><br>

                <label>Northeast Coordinate</label>
                <br>
                <input type="text" id="rightLong" class="coordinateInput" placeholder="East-most longitude">
                <br>
                <input type="text" id="topLat" class="coordinateInput" placeholder="North-most latitude">

                <br><br>

                <select id="requestType">
                    <option value="photos">Photos</option>
                    <option value="json">JSON</option>
                </select>

                <br><br>

                <button id="submit" disabled>Submit</button>

            </div>
            <div id="output"></div>
        </div>
    </body>
</html>
